(function(c,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(c=typeof globalThis<"u"?globalThis:c||self,c.NestedList=u())})(this,function(){"use strict";function c(p,e=null,t={}){const r=document.createElement(p);Array.isArray(e)?r.classList.add(...e):e&&r.classList.add(e);for(const s in t)r[s]=t[s];return r}function u(p){const e=c("div");return e.appendChild(p),e.innerHTML}function C(p){let e;return p.nodeType!==Node.ELEMENT_NODE?e=p.textContent:(e=p.innerHTML,e=e.replaceAll("<br>","")),e.trim().length===0}class d{constructor(){this.savedFakeCaret=void 0}save(){const e=d.range,t=c("span");t.hidden=!0,e.insertNode(t),this.savedFakeCaret=t}restore(){if(!this.savedFakeCaret)return;const e=window.getSelection(),t=new Range;t.setStartAfter(this.savedFakeCaret),t.setEndAfter(this.savedFakeCaret),e.removeAllRanges(),e.addRange(t),setTimeout(()=>{this.savedFakeCaret.remove()},150)}static get range(){const e=window.getSelection();return e&&e.rangeCount?e.getRangeAt(0):null}static extractFragmentFromCaretPositionTillTheEnd(){const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0);let r=t.startContainer;r.nodeType!==Node.ELEMENT_NODE&&(r=r.parentNode);const s=r.closest("[contenteditable]");t.deleteContents();const n=t.cloneRange();return n.selectNodeContents(s),n.setStart(t.endContainer,t.endOffset),n.extractContents()}static focus(e,t=!0){const r=document.createRange(),s=window.getSelection();r.selectNodeContents(e),r.collapse(t),s.removeAllRanges(),s.addRange(r)}static isAtStart(){const e=window.getSelection();if(e.focusOffset>0)return!1;const t=e.focusNode;return d.getHigherLevelSiblings(t,"left").every(n=>C(n))}static getHigherLevelSiblings(e,t="left"){let r=e;const s=[];for(;r.parentNode&&r.parentNode.contentEditable!=="true";)r=r.parentNode;const n=t==="left"?"previousSibling":"nextSibling";for(;r[n];)r=r[n],s.push(r);return s}}const k='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><line x1="9" x2="19" y1="7" y2="7" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="9" x2="19" y1="12" y2="12" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="9" x2="19" y1="17" y2="17" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.00001 17H4.99002"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.00001 12H4.99002"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5.00001 7H4.99002"/></svg>',y='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><line x1="12" x2="19" y1="7" y2="7" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="12" x2="19" y1="12" y2="12" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><line x1="12" x2="19" y1="17" y2="17" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7.79999 14L7.79999 7.2135C7.79999 7.12872 7.7011 7.0824 7.63597 7.13668L4.79999 9.5"/></svg>';class m{static get isReadOnlySupported(){return!0}static get enableLineBreaks(){return!0}static get toolbox(){return{icon:y,title:"List"}}constructor({data:e,config:t,api:r,readOnly:s}){this.nodes={wrapper:null},this.api=r,this.readOnly=s,this.config=t,this.defaultListStyle=this.config.defaultStyle==="ordered"?"ordered":"unordered";const n={style:this.defaultListStyle,items:[]};this.data=e&&Object.keys(e).length?e:n,this.caret=new d}render(){return this.nodes.wrapper=this.makeListWrapper(this.data.style,[this.CSS.baseBlock]),this.data.items.length?this.appendItems(this.data.items,this.nodes.wrapper):this.appendItems([{content:"",items:[]}],this.nodes.wrapper),this.readOnly||this.nodes.wrapper.addEventListener("keydown",e=>{switch(e.key){case"Enter":this.enterPressed(e);break;case"Backspace":this.backspace(e);break;case"Tab":e.shiftKey?this.shiftTab(e):this.addTab(e);break}},!1),this.nodes.wrapper}renderSettings(){return[{name:"unordered",label:this.api.i18n.t("Unordered"),icon:k},{name:"ordered",label:this.api.i18n.t("Ordered"),icon:y}].map(t=>({name:t.name,icon:t.icon,label:t.label,isActive:this.data.style===t.name,closeOnActivate:!0,onActivate:()=>{this.listStyle=t.name}}))}static get pasteConfig(){return{tags:["OL","UL","LI"]}}onPaste(e){const t=e.detail.data;this.data=this.pasteHandler(t);const r=this.nodes.wrapper;r&&r.parentNode.replaceChild(this.render(),r)}pasteHandler(e){const{tagName:t}=e;let r,s;switch(t){case"OL":r="ordered",s="ol";break;case"UL":case"LI":r="unordered",s="ul"}const n={style:r,items:[]},a=o=>{let i=[];return Array.from(o.querySelectorAll(`:scope > li, :scope > ${s}`)).map(f=>{if(f.tagName===t){const S=h(o),w=i.pop();w.items=S,i=i.concat(w)}else{const S=l(f);i=i.concat(S)}}),i},l=o=>{var g;const i=h(o);return{content:((g=o==null?void 0:o.firstChild)==null?void 0:g.textContent)||"",items:i}},h=o=>{let i=[];return Array.from(o.querySelectorAll(`:scope > ${s}`)).map(f=>{i=i.concat(a(f))}),i};return n.items=a(e),n}appendItems(e,t){e.forEach(r=>{const s=this.createItem(r.content,r.items);t.appendChild(s)})}createItem(e,t=[]){const r=c("li",this.CSS.item),s=c("div",this.CSS.itemBody),n=c("div",this.CSS.itemContent,{innerHTML:e,contentEditable:!this.readOnly});return s.appendChild(n),r.appendChild(s),t&&t.length>0&&this.addChildrenList(r,t),r}save(){const e=t=>Array.from(t.querySelectorAll(`:scope > .${this.CSS.item}`)).map(s=>{const n=s.querySelector(`.${this.CSS.itemChildren}`),a=this.getItemContent(s),l=n?e(n):[];return{content:a,items:l}});return{style:this.data.style,items:e(this.nodes.wrapper)}}addChildrenList(e,t){const r=e.querySelector(`.${this.CSS.itemBody}`),s=this.makeListWrapper(void 0,[this.CSS.itemChildren]);this.appendItems(t,s),r.appendChild(s)}makeListWrapper(e=this.listStyle,t=[]){const r=e==="ordered"?"ol":"ul",s=e==="ordered"?this.CSS.wrapperOrdered:this.CSS.wrapperUnordered;return t.push(s),c(r,[this.CSS.wrapper,...t])}get CSS(){return{baseBlock:this.api.styles.block,wrapper:"cdx-nested-list",wrapperOrdered:"cdx-nested-list--ordered",wrapperUnordered:"cdx-nested-list--unordered",item:"cdx-nested-list__item",itemBody:"cdx-nested-list__item-body",itemContent:"cdx-nested-list__item-content",itemChildren:"cdx-nested-list__item-children",settingsWrapper:"cdx-nested-list__settings",settingsButton:this.api.styles.settingsButton,settingsButtonActive:this.api.styles.settingsButtonActive}}get listStyle(){return this.data.style||this.defaultListStyle}set listStyle(e){const t=Array.from(this.nodes.wrapper.querySelectorAll(`.${this.CSS.wrapper}`));t.push(this.nodes.wrapper),t.forEach(r=>{r.classList.toggle(this.CSS.wrapperUnordered,e==="unordered"),r.classList.toggle(this.CSS.wrapperOrdered,e==="ordered")}),this.data.style=e}get currentItem(){let e=window.getSelection().anchorNode;return e.nodeType!==Node.ELEMENT_NODE&&(e=e.parentNode),e.closest(`.${this.CSS.item}`)}enterPressed(e){const t=this.currentItem;if(e.stopPropagation(),e.preventDefault(),e.isComposing)return;const r=this.getItemContent(t).trim().length===0,s=t.parentNode===this.nodes.wrapper,n=t.nextElementSibling===null;if(s&&n&&r){this.getOutOfList();return}else if(n&&r){this.unshiftItem();return}const a=d.extractFragmentFromCaretPositionTillTheEnd(),l=u(a),h=t.querySelector(`.${this.CSS.itemChildren}`),o=this.createItem(l,void 0);h&&Array.from(h.querySelectorAll(`.${this.CSS.item}`)).length>0?h.prepend(o):t.after(o),this.focusItem(o)}unshiftItem(){const e=this.currentItem,t=e.parentNode.closest(`.${this.CSS.item}`);if(!t)return;this.caret.save(),t.after(e),this.caret.restore();const r=t.querySelector(`.${this.CSS.itemChildren}`);r.children.length===0&&r.remove()}getItemContent(e){const t=e.querySelector(`.${this.CSS.itemContent}`);return C(t)?"":t.innerHTML}focusItem(e,t=!0){const r=e.querySelector(`.${this.CSS.itemContent}`);d.focus(r,t)}getOutOfList(){this.currentItem.remove(),this.api.blocks.insert(),this.api.caret.setToBlock(this.api.blocks.getCurrentBlockIndex())}backspace(e){if(!d.isAtStart())return;e.preventDefault();const t=this.currentItem,r=t.previousSibling,s=t.parentNode.closest(`.${this.CSS.item}`);if(!r&&!s)return;e.stopPropagation();let n;if(r){const i=r.querySelectorAll(`.${this.CSS.item}`);n=Array.from(i).pop()||r}else n=s;const a=d.extractFragmentFromCaretPositionTillTheEnd(),l=u(a),h=n.querySelector(`.${this.CSS.itemContent}`);d.focus(h,!1),this.caret.save(),h.insertAdjacentHTML("beforeend",l);let o=t.querySelectorAll(`.${this.CSS.itemChildren} > .${this.CSS.item}`);o=Array.from(o),o=o.filter(i=>i.parentNode.closest(`.${this.CSS.item}`)===t),o.reverse().forEach(i=>{r?n.after(i):t.after(i)}),t.remove(),this.caret.restore()}addTab(e){e.stopPropagation(),e.preventDefault();const t=this.currentItem,r=t.previousSibling;if(!r)return;const n=r.querySelector(`.${this.CSS.itemChildren}`);if(this.caret.save(),n)n.appendChild(t);else{const a=this.makeListWrapper(void 0,[this.CSS.itemChildren]),l=r.querySelector(`.${this.CSS.itemBody}`);a.appendChild(t),l.appendChild(a)}this.caret.restore()}shiftTab(e){e.stopPropagation(),e.preventDefault(),this.unshiftItem()}static joinRecursive(e){return e.items.map(t=>`${t.content} ${m.joinRecursive(t)}`).join("")}static get conversionConfig(){return{export:e=>m.joinRecursive(e),import:e=>({items:[{content:e,items:[]}],style:"unordered"})}}}return m});
